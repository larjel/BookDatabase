(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,n){e.exports=n(24)},20:function(e,t,n){},21:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(11),s=n.n(o),i=(n(20),n(21),n(8)),c=n(2),u=n(3),l=n(5),d=n(4),p=n(6),m=function(e){return r.a.createElement("header",null,r.a.createElement("strong",null,"BOKDATABASEN (byggd med JavaScript, React och AJAX)"))},f=n(13),b=n(9),h=n(1),k=n.n(h),g=n(7),v=n(12),E="https://www.forverkliga.se/JavaScript/api/crud.php";var y=function(){var e=Object(g.a)(k.a.mark(function e(){var t,n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem("apiKey"))){e.next=6;break}return console.log("Cached key "+t+" used!"),e.abrupt("return",t);case 6:return e.prev=6,e.next=9,fetch("".concat(E,"?requestKey")).then(function(e){return e.json()}).then(function(e){return e.key});case 9:return n=e.sent,localStorage.setItem("apiKey",n),console.log("New key "+n+" used!"),e.abrupt("return",n);case 15:return e.prev=15,e.t0=e.catch(6),console.log("Error fetching API key!"),e.abrupt("return",e.t0);case 19:case"end":return e.stop()}},e,null,[[6,15]])}));return function(){return e.apply(this,arguments)}}(),O=function(){var e=Object(g.a)(k.a.mark(function e(t){var n,a,r,o,s,i,c,u,l,d=arguments;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:10,a=d.length>2&&void 0!==d[2]?d[2]:1,e.next=4,y();case 4:return r=e.sent,p=Object(b.a)({},t,{key:r}),o=Object.entries(p).map(function(e){var t=Object(v.a)(e,2),n=t[0],a=t[1];return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(a))}).join("&").replace(/%20/g,"+"),s="".concat(E,"?").concat(o),console.log("Request URL: "+s),e.next=10,fetch(s).then(function(e){return e.json()});case 10:if(i=e.sent,c=i.status,u=i.message,l=Object(f.a)(i,["status","message"]),"success"!==c){e.next=18;break}return e.abrupt("return",Object(b.a)({},l,{status:c,tryCount:a}));case 18:if(!(n>0&&"error"===c)){e.next=23;break}return console.log("Retrying request. Limit="+n+" Message="+u),e.abrupt("return",O(t,n-1,a+1));case 23:return e.abrupt("return",{status:c,message:u});case 24:case"end":return e.stop()}var p},e)}));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(g.a)(k.a.mark(function e(){var t;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={op:"select"},e.next=3,O(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),w=function(){var e=Object(g.a)(k.a.mark(function e(t,n){var a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={op:"insert",title:t,author:n},e.next=3,O(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),N=function(){var e=Object(g.a)(k.a.mark(function e(t){var n;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:t,op:"delete"},e.next=3,O(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(g.a)(k.a.mark(function e(t,n,a){var r;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={id:t,title:n,author:a,op:"update"},e.next=3,O(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}(),I=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault();var t=n.state.title,a=n.state.author,r=n.state.id;console.log("Update book: Title: "+t+" Author: "+a+" ID: "+r),C(r,t,a).then(function(e){"success"===e.status?(n.props.updateBookInList(r,t,a),n.props.setEditing(!1,{}),n.props.setInfoMessage("Boken har uppdaterats! Det kr\xe4vdes "+e.tryCount+" f\xf6rs\xf6k.")):n.props.setInfoMessage("Fel! Kunde inte uppdatera bok. Meddelande: "+e.message,!0)})},n.handleAbort=function(){n.props.setEditing(!1,{}),n.props.setInfoMessage("Operationen avbr\xf6ts.")},n.state={title:n.props.book.title,author:n.props.book.author,id:n.props.book.id},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("form",{className:"book-form col-6",onSubmit:this.handleSubmit},r.a.createElement("legend",null,"Uppdatera information om boken"),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",id:"title",placeholder:"Ny titel",value:this.state.title,onChange:function(t){return e.setState({title:t.target.value})},required:!0}),r.a.createElement("input",{type:"text",className:"form-control",id:"author",placeholder:"Ny f\xf6rfattare",value:this.state.author,onChange:function(t){return e.setState({author:t.target.value})},required:!0})),r.a.createElement("button",{type:"submit",className:"btn btn-success"},"Uppdatera"),r.a.createElement("button",{type:"button",className:"btn btn-danger btn-update-abort",onClick:this.handleAbort},"Avbryt"))}}]),t}(a.Component),B=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault();var t=n.state.title,a=n.state.author;console.log("Add book: Title: "+t+" Author: "+a),w(t,a).then(function(e){console.log("Add book response: ",e),"success"===e.status?(n.props.addBookToList(e.id,t,a),n.setState({title:"",author:""}),n.props.setInfoMessage("Boken har lagts till! Det kr\xe4vdes "+e.tryCount+" f\xf6rs\xf6k.")):n.props.setInfoMessage("Fel! Kunde inte l\xe4gga till bok. Meddelande: "+e.message,!0)})},n.state={title:"",author:""},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("form",{className:"book-form col-6",onSubmit:this.handleSubmit},r.a.createElement("legend",null,"L\xe4gg till dina favoritb\xf6cker"),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",id:"title",placeholder:"L\xe4gg till titel",value:this.state.title,onChange:function(t){return e.setState({title:t.target.value})},required:!0}),r.a.createElement("input",{type:"text",className:"form-control",id:"author",placeholder:"L\xe4gg till f\xf6rfattare",value:this.state.author,onChange:function(t){return e.setState({author:t.target.value})},required:!0})),r.a.createElement("button",{type:"submit",className:"btn btn-primary btn-lg btn-block"},"Skicka"))}}]),t}(a.Component),x=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(l.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).handleRemoveBookClick=function(){var e=n.props;e.removeBook(e.id)},n.enableEditingClick=function(){var e=n.props;e.setEditing(!0,e)},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props;return r.a.createElement("li",{className:"list-item list-group-item d-flex align-items-center"},r.a.createElement("strong",{className:"title"},e.title),r.a.createElement("div",{className:"author"},e.author),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{type:"button",className:"btn btn-success",onClick:this.enableEditingClick},"Editera"),r.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleRemoveBookClick},"Ta bort")))}}]),t}(a.Component),M=function(e){return r.a.createElement("div",null,e.books.map(function(t){return r.a.createElement(x,Object.assign({},e,{key:t.id},t))}))},S=function(e){return r.a.createElement("div",{className:"book-form col-6 info-box"},e.text)},A=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(l.a)(this,Object(d.a)(t).call(this,e))).addBookToList=function(e,t,a){n.setState(function(n){return{books:[].concat(Object(i.a)(n.books),[{id:e,title:t,author:a}])}})},n.updateBookInList=function(e,t,a){n.setState(function(n){var r=Object(i.a)(n.books),o=r.findIndex(function(t){return t.id===e});return o>=0&&(r[o].title=t,r[o].author=a),{books:r}})},n.removeBook=function(e){N(e).then(function(t){"success"===t.status?(n.removeBookFromList(e),n.setInfoMessage("Boken har tagits bort! Det kr\xe4vdes "+t.tryCount+" f\xf6rs\xf6k.")):n.setInfoMessage("Fel! Kunde inte ta bort boken. Meddelande: "+t.message,!0)})},n.setEditing=function(e,t){n.setState({bookToEdit:t,editing:e})},n.setInfoMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.setState({infoMessage:e}),t&&window.alert(e)},n.handleUpdateListClick=function(){n.fetchBooks()},n.handleClearApiKeyClick=function(){window.confirm("Varning! Om du forts\xe4tter kommer den gamla databasen inte l\xe4ngre vara tillg\xe4nglig.")?(localStorage.removeItem("apiKey"),n.setInfoMessage("API-nyckeln har nollst\xe4llts!"),n.setState({books:[]})):n.setInfoMessage("Operationen avbr\xf6ts.")},n.state={books:[],editing:!1,bookToEdit:{},infoMessage:"V\xe4lkommen till bokdatabasen!"},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"removeBookFromList",value:function(e){this.setState(function(t){return{books:t.books.filter(function(t){return t.id!==e})}})}},{key:"fetchBooks",value:function(){var e=this;j().then(function(t){console.log("fetchBooks() response: ",t),"success"===t.status?(e.setState({books:t.data}),e.setInfoMessage("Boklistan har uppdaterats! Det kr\xe4vdes "+t.tryCount+" f\xf6rs\xf6k.")):e.setInfoMessage("Fel! Kunde inte uppdatera boklistan. Meddelande: "+t.message,!0)})}},{key:"componentDidMount",value:function(){this.fetchBooks()}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(m,null),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row form-section"},this.state.editing?r.a.createElement(I,{updateBookInList:this.updateBookInList,setEditing:this.setEditing,book:this.state.bookToEdit,setInfoMessage:this.setInfoMessage}):r.a.createElement(B,{addBookToList:this.addBookToList,setInfoMessage:this.setInfoMessage})),r.a.createElement(S,{text:this.state.infoMessage})),r.a.createElement("div",{className:"display-books"},r.a.createElement("div",{className:"container"},r.a.createElement("ul",{className:"list-group"},r.a.createElement("li",{className:"list-item list-group-item d-flex align-items-center list-heading"},r.a.createElement("strong",{className:"title"},"Titel"),r.a.createElement("strong",{className:"author"},"F\xf6rfattare"),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{type:"button",className:"btn btn-success",onClick:this.handleUpdateListClick},"Uppdatera lista"),r.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleClearApiKeyClick},"Rensa API-nyckel"))),r.a.createElement(M,{books:this.state.books,removeBook:this.removeBook,setEditing:this.setEditing})))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[14,1,2]]]);
//# sourceMappingURL=main.bc2445f1.chunk.js.map