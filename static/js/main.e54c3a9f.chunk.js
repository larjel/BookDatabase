(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{36:function(e,t,n){e.exports=n(79)},42:function(e,t,n){},43:function(e,t,n){},79:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(18),s=n.n(o),c=(n(42),n(43),n(20)),i=n(7),l=n(8),u=n(10),p=n(9),d=n(11),m=n(15),f=n.n(m),h=n(19),b=n.n(h),g=function(e){return r.a.createElement("header",null,r.a.createElement(f.a,{expand:"lg",className:"navbar-dark"},r.a.createElement(m.Brand,{href:"#home"},"Laboration 2: JavaScript/React/AJAX"),r.a.createElement(m.Toggle,{"aria-controls":"basic-navbar-nav"}),r.a.createElement(m.Collapse,{id:"basic-navbar-nav"},r.a.createElement(b.a,{className:"mr-auto"},r.a.createElement(h.Link,{href:"https://www.forverkliga.se/JavaScript/api/crud.php"},"API Docs")))))},k=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).handleRemoveBookClick=function(){var e=n.props;e.removeBook(e.id)},n.enableEditingClick=function(){var e=n.props;e.setEditing(!0,e)},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props;return r.a.createElement("li",{className:"list-item list-group-item d-flex align-items-center"},r.a.createElement("strong",{className:"title"},e.title),r.a.createElement("div",{className:"author"},e.author),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{type:"button",className:"btn btn-success",onClick:this.enableEditingClick},"Editera"),r.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleRemoveBookClick},"Ta bort")))}}]),t}(a.Component),v=n(35),E=n(21),y=n(3),w=n.n(y),j=n(12),N=n(34),O="https://www.forverkliga.se/JavaScript/api/crud.php";var C=function(){var e=Object(j.a)(w.a.mark(function e(){var t,n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem("apiKey"))){e.next=6;break}return console.log("Cached key "+t+" used!"),e.abrupt("return",t);case 6:return e.prev=6,e.next=9,fetch("".concat(O,"?requestKey")).then(function(e){return e.json()}).then(function(e){return e.key});case 9:return n=e.sent,localStorage.setItem("apiKey",n),console.log("New key "+n+" used!"),e.abrupt("return",n);case 15:return e.prev=15,e.t0=e.catch(6),console.log("Error fetching API key!"),e.abrupt("return",e.t0);case 19:case"end":return e.stop()}},e,null,[[6,15]])}));return function(){return e.apply(this,arguments)}}(),I=function(){var e=Object(j.a)(w.a.mark(function e(t){var n,a,r,o,s,c,i,l,u,p=arguments;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.length>1&&void 0!==p[1]?p[1]:10,a=p.length>2&&void 0!==p[2]?p[2]:1,e.next=4,C();case 4:return r=e.sent,d=Object(E.a)({},t,{key:r}),o=Object.entries(d).map(function(e){var t=Object(N.a)(e,2),n=t[0],a=t[1];return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(a))}).join("&").replace(/%20/g,"+"),s="".concat(O,"?").concat(o),console.log("Fetching URL: "+s),e.next=10,fetch(s).then(function(e){return e.json()});case 10:if(c=e.sent,i=c.status,l=c.message,u=Object(v.a)(c,["status","message"]),"success"!==i){e.next=18;break}return e.abrupt("return",Object(E.a)({},u,{status:i,tryCount:a}));case 18:if(!(n>0&&"error"===i)){e.next=23;break}return console.log("Retrying request. Limit="+n+" Message="+l),e.abrupt("return",I(t,n-1,a+1));case 23:return e.abrupt("return",{status:i,message:l});case 24:case"end":return e.stop()}var d},e)}));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=Object(j.a)(w.a.mark(function e(){var t;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={op:"select"},e.next=3,I(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(j.a)(w.a.mark(function e(t,n){var a;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={op:"insert",title:t,author:n},e.next=3,I(a);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),S=function(){var e=Object(j.a)(w.a.mark(function e(t){var n;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={id:t,op:"delete"},e.next=3,I(n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=Object(j.a)(w.a.mark(function e(t,n,a){var r;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={id:t,title:n,author:a,op:"update"},e.next=3,I(r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}(),A=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={title:n.props.book.title,author:n.props.book.author,id:n.props.book.id},n.handleSubmit=function(e){e.preventDefault();var t=n.state.title,a=n.state.author,r=n.state.id;console.log("Title: "+t+" Author: "+a+" ID: "+r),M(r,t,a).then(function(e){console.log("Status: ",e.status),"success"===e.status?(n.props.updateBookInList(r,t,a),n.props.setEditing(!1,{}),n.props.setInfoMessage("Boken har uppdaterats! Det kr\xe4vdes "+e.tryCount+" f\xf6rs\xf6k.")):n.props.setInfoMessage("Fel! Kunde inte uppdatera bok. Meddelande: "+e.message,!0)})},n.handleAbort=function(){n.props.setEditing(!1,{})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("form",{className:"book-form col-6",onSubmit:this.handleSubmit},r.a.createElement("legend",null,"Uppdatera information om boken"),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",id:"title",placeholder:"Ny titel",value:this.state.title,onChange:function(t){return e.setState({title:t.target.value})},required:!0}),r.a.createElement("input",{type:"text",className:"form-control",id:"author",placeholder:"Ny f\xf6rfattare",value:this.state.author,onChange:function(t){return e.setState({author:t.target.value})},required:!0})),r.a.createElement("button",{type:"submit",className:"btn btn-success"},"Uppdatera"),r.a.createElement("button",{type:"button",className:"btn btn-danger btn-update-abort",onClick:this.handleAbort},"Avbryt"))}}]),t}(a.Component),L=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={title:"",author:""},n.handleSubmit=function(e){e.preventDefault();var t=n.state.title,a=n.state.author;console.log("Title: "+t+" Author: "+a),B(t,a).then(function(e){console.log("Response: ",e),console.log("ID: ",e.id),console.log("Status: ",e.status),"success"===e.status?(n.props.addBookToList(e.id,t,a),n.setState({title:"",author:""}),n.props.setInfoMessage("Boken har lagts till! Det kr\xe4vdes "+e.tryCount+" f\xf6rs\xf6k.")):n.props.setInfoMessage("Fel! Kunde inte l\xe4gga till bok. Meddelande: "+e.message,!0)})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("form",{className:"book-form col-6",onSubmit:this.handleSubmit},r.a.createElement("legend",null,"L\xe4gg till dina favoritb\xf6cker"),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"text",className:"form-control",id:"title",placeholder:"L\xe4gg till titel",value:this.state.title,onChange:function(t){return e.setState({title:t.target.value})},required:!0}),r.a.createElement("input",{type:"text",className:"form-control",id:"author",placeholder:"L\xe4gg till f\xf6rfattare",value:this.state.author,onChange:function(t){return e.setState({author:t.target.value})},required:!0})),r.a.createElement("button",{type:"submit",className:"btn btn-primary btn-lg btn-block"},"Skicka"))}}]),t}(a.Component),D=function(e){return r.a.createElement("div",null,e.books.map(function(t){return r.a.createElement(k,Object.assign({},e,{key:t.id},t))}))},T=function(e){return r.a.createElement("div",{className:"book-form col-6 info-box"},e.text)},R=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={books:[],editing:!1,bookToEdit:{},infoMessage:"V\xe4lkommen till bokdatabasen!"},n.addBookToList=function(e,t,a){console.log("App: New book added"),n.setState(function(n){return{books:[].concat(Object(c.a)(n.books),[{id:e,title:t,author:a}])}})},n.updateBookInList=function(e,t,a){n.setState(function(n){var r=Object(c.a)(n.books);return r.forEach(function(n){n.id===e&&(n.title=t,n.author=a)}),{books:r}})},n.removeBook=function(e){S(e).then(function(t){"success"===t.status?(console.log("Remove book success!"),n.removeBookFromList(e),n.setInfoMessage("Boken har tagits bort! Det kr\xe4vdes "+t.tryCount+" f\xf6rs\xf6k.")):n.setInfoMessage("Fel! Kunde inte ta bort boken. Meddelande: "+t.message,!0)})},n.setEditing=function(e,t){n.setState(function(){return{bookToEdit:t,editing:e}})},n.setInfoMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n.setState(function(){return{infoMessage:e}}),t&&window.alert(e)},n.handleUpdateListClick=function(){n.fetchBooks()},n.handleClearApiKeyClick=function(){localStorage.removeItem("apiKey"),n.setInfoMessage("API-nyckeln har nollst\xe4llts!"),n.setState(function(e){return{books:[]}})},n}return Object(d.a)(t,e),Object(l.a)(t,[{key:"removeBookFromList",value:function(e){this.setState(function(t){return{books:t.books.filter(function(t){return t.id!==e})}})}},{key:"fetchBooks",value:function(){var e=this;x().then(function(t){console.log("Response: ",t),console.log("ID: ",t.id),console.log("Data: ",t.data),"success"===t.status?(console.log("fetchBooks() success!"),e.setState(function(){return{books:t.data}}),e.setInfoMessage("Boklistan har uppdaterats! Det kr\xe4vdes "+t.tryCount+" f\xf6rs\xf6k.")):e.setInfoMessage("Fel! Kunde inte uppdatera boklistan. Meddelande: "+t.message,!0)})}},{key:"componentDidMount",value:function(){this.fetchBooks()}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(g,null),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"row form-section"},this.state.editing?r.a.createElement(A,{updateBookInList:this.updateBookInList,setEditing:this.setEditing,book:this.state.bookToEdit,setInfoMessage:this.setInfoMessage}):r.a.createElement(L,{addBookToList:this.addBookToList,setInfoMessage:this.setInfoMessage})),r.a.createElement(T,{text:this.state.infoMessage})),r.a.createElement("div",{className:"display-books"},r.a.createElement("div",{className:"container"},r.a.createElement("ul",{className:"list-group"},r.a.createElement("li",{className:"list-item list-group-item d-flex align-items-center list-heading"},r.a.createElement("strong",{className:"title"},"Titel"),r.a.createElement("strong",{className:"author"},"F\xf6rfattare"),r.a.createElement("div",{className:"buttons"},r.a.createElement("button",{type:"button",className:"btn btn-success",onClick:this.handleUpdateListClick},"Uppdatera lista"),r.a.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleClearApiKeyClick},"Rensa API-nyckel"))),r.a.createElement(D,{books:this.state.books,removeBook:this.removeBook,setEditing:this.setEditing})))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[36,1,2]]]);
//# sourceMappingURL=main.e54c3a9f.chunk.js.map